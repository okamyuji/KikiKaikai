# 奇々怪界風ゲーム設計書

## 1. ゲーム概要

### 1.1 プロジェクト名

**KikiKaikai** - macOS向け奇々怪界風アクションシューティングゲーム

### 1.2 ゲームジャンル

2Dアクションシューティングゲーム

### 1.3 ターゲットプラットフォーム

- macOS 12.0以上
- SwiftUI + SpriteKit
- Single Player

### 1.4 基本コンセプト

巫女の小夜ちゃんが妖怪の世界で七福神を救出するアクションシューティングゲーム。オリジナルの奇々怪界の魅力である「可愛い見た目と硬派なゲーム性」を再現し、現代的なSwiftUIとSpriteKitで実装する。

## 2. ゲームシステム設計

### 2.1 基本操作

- **移動**: WASD キーまたは矢印キー（8方向移動）
- **お札攻撃**: スペースキー（遠距離攻撃）
- **御祓い棒攻撃**: Zキー（近距離攻撃）
- **水晶玉**: Xキー（特殊アイテム使用）
- **ポーズ**: ESCキー

### 2.2 プレイヤーキャラクター

- **小夜ちゃん**: 巫女装束の主人公
- **体力**: 3（ハート3つ）
- **移動速度**: 中程度
- **当たり判定**: 小さめ（高精度要求）

### 2.3 武器システム

#### 2.3.1 お札攻撃

- 最大4枚まで画面内に存在可能
- 直線的な飛行軌道
- パワーアップで威力・速度・射程が向上
- 敵に当たると消滅

#### 2.3.2 御祓い棒攻撃

- 近距離範囲攻撃
- 連続使用可能
- お札より高威力
- 緊急回避時の最終手段

#### 2.3.3 水晶玉

- 画面上の全敵を6-9秒間停止
- 使用制限あり（ステージごとに1-2個）
- 緊急脱出用の戦略アイテム

### 2.4 パワーアップシステム

#### 2.4.1 力玉（パワーアップアイテム）

- **橙色の力玉**: お札の威力向上
- **青色の力玉**: お札の速度・射程向上
- **緑色の力玉**: お札の貫通性能向上

#### 2.4.2 その他アイテム

- **体力回復**: ハートマーク
- **水晶玉補充**: 青い宝石
- **ボーナスポイント**: 金貨

### 2.5 敵キャラクターシステム

#### 2.5.1 基本敵キャラ

1. **人魂**: 編隊を組んで移動、弾を発射
2. **化け提灯**: 火の玉を発射して逃走
3. **ろくろ首**: 体当たり攻撃
4. **留無留**: プレイヤーに取り憑く特殊敵

#### 2.5.2 ボスキャラ

- **豆頭**: ステージ1ボス、多段階変身
- **大妖怪**: 各ステージの最終ボス
- 複雑な攻撃パターンと高耐久力

### 2.6 ステージ構成

- **ステージ数**: 5ステージ
- **各ステージ**: 3-4エリア構成
- **ボス戦**: 各ステージ最後
- **難易度**: 段階的上昇

## 3. 技術アーキテクチャ

### 3.1 フレームワーク構成

```text
SwiftUI (UI Framework)
├── SpriteKit (Game Engine)
├── AVFoundation (Audio)
├── Combine (Reactive Programming)
└── UserDefaults (Settings & Save Data)
```

### 3.2 アプリケーション構造

```text
KikiKaikai/
├── Sources/
│   ├── KikiKaikai/
│   │   ├── main.swift
│   │   ├── App/
│   │   │   ├── KikiKaikaiApp.swift
│   │   │   └── ContentView.swift
│   │   ├── Game/
│   │   │   ├── GameScene.swift
│   │   │   ├── GameState.swift
│   │   │   └── GameManager.swift
│   │   ├── Entities/
│   │   │   ├── Player.swift
│   │   │   ├── Enemy.swift
│   │   │   ├── Projectile.swift
│   │   │   └── Item.swift
│   │   ├── Systems/
│   │   │   ├── InputSystem.swift
│   │   │   ├── CollisionSystem.swift
│   │   │   ├── AudioSystem.swift
│   │   │   └── ScoreSystem.swift
│   │   ├── Utils/
│   │   │   ├── Extensions.swift
│   │   │   ├── Constants.swift
│   │   │   └── AssetManager.swift
│   │   └── Resources/
│   │       ├── Images/
│   │       ├── Sounds/
│   │       └── Data/
├── Tests/
├── Package.swift
└── README.md
```

### 3.3 主要クラス設計

#### 3.3.1 GameScene

```swift
class GameScene: SKScene {
    - currentStage: Int
    - player: Player
    - enemies: [Enemy]
    - projectiles: [Projectile]
    - gameState: GameState
    
    + update(_:)
    + didMove(to:)
    + keyDown(with:)
    + handleCollisions()
}
```

#### 3.3.2 Player

```swift
class Player: SKSpriteNode {
    - health: Int
    - powerLevel: [PowerType: Int]
    - crystalBalls: Int
    - isInvincible: Bool
    
    + move(direction:)
    + shootOfuda()
    + useOharaiStick()
    + useCrystalBall()
    + takeDamage()
}
```

#### 3.3.3 Enemy

```swift
protocol Enemy: SKSpriteNode {
    - health: Int
    - scoreValue: Int
    - movementPattern: MovementPattern
    
    + update()
    + takeDamage(_:)
    + performAttack()
}
```

## 4. アセット仕様

### 4.1 グラフィックスアセット

#### 4.1.1 キャラクタースプライト

- **解像度**: 32x32 ピクセル（基本サイズ）
- **フォーマット**: PNG（透明背景）
- **アニメーション**: 4-8フレーム
- **色数**: 16色パレット（レトロ風）

#### 4.1.2 背景・ステージ

- **タイル**: 32x32 ピクセル
- **画面サイズ**: 1024x768（4:3比率）
- **レイヤー**: 背景・中景・前景の3層構造

#### 4.1.3 UI要素

- **解像度**: 16x16, 32x32 ピクセル
- **スタイル**: ピクセルアート風
- **カラーパレット**: 和風テーマ

### 4.2 サウンドアセット

#### 4.2.1 BGM

- **フォーマット**: OGG Vorbis
- **長さ**: 2-3分ループ
- **スタイル**: 童謡・わらべ歌アレンジ
- **ビットレート**: 160kbps

#### 4.2.2 効果音

- **フォーマット**: WAV（短い音）
- **長さ**: 0.1-2秒
- **種類**: 攻撃音、敵撃破音、アイテム取得音等

### 4.3 アセット取得計画

#### 4.3.1 画像アセット

- **OpenGameArt.org**: CC0ライセンス素材
- **Pixabay**: 商用利用可能素材
- **Unsplash**: 背景用写真素材
- **自作**: ピクセルアートツールで作成

#### 4.3.2 音楽・効果音

- **Freesound.org**: CC0効果音
- **OpenMusicArchive**: パブリックドメイン童謡
- **Zapsplat**: 商用利用可能効果音（要登録）
- **自作**: Logic Pro / GarageBandで作成

## 5. 実装計画

### 5.1 Phase 1: 基盤実装（Week 1）

1. プロジェクト構成とPackage.swift設定
2. 基本的なSwiftUIアプリ構造
3. SpriteKitシーンの基本実装
4. プレイヤーキャラクターの移動実装

### 5.2 Phase 2: コア機能実装（Week 2）

1. お札攻撃システム
2. 基本的な敵キャラクター
3. 衝突判定システム
4. 基本的なUI（体力、スコア表示）

### 5.3 Phase 3: ゲームプレイ拡張（Week 3）

1. 御祓い棒攻撃実装
2. パワーアップシステム
3. 複数の敵キャラクタータイプ
4. ステージ遷移システム

### 5.4 Phase 4: 完成・ポリッシュ（Week 4）

1. ボスキャラクター実装
2. サウンドシステム統合
3. ゲームバランス調整
4. UI/UX改善

## 6. パフォーマンス要件

### 6.1 フレームレート

- **ターゲット**: 60 FPS
- **最低**: 30 FPS
- **最適化**: スプライトプーリング、効率的な衝突判定

### 6.2 メモリ使用量

- **最大**: 512MB
- **推奨**: 256MB以下
- **最適化**: テクスチャアトラス、オーディオ圧縮

### 6.3 システム要件

- **OS**: macOS 12.0以上
- **RAM**: 4GB以上
- **Storage**: 100MB以上
- **Graphics**: Metal対応GPU

## 7. 品質保証

### 7.1 テスト計画

1. **単体テスト**: 各システムの独立テスト
2. **統合テスト**: システム間連携テスト
3. **ゲームプレイテスト**: 実際のプレイによる評価
4. **パフォーマンステスト**: フレームレート・メモリ使用量

### 7.2 デバッグ機能

- ゲーム内デバッグメニュー
- 当たり判定の可視化
- パフォーマンス統計表示
- ステージスキップ機能

### 7.3 バランス調整

- 敵の出現頻度調整
- ダメージ・体力バランス
- アイテム出現率調整
- 難易度カーブの最適化

## 8. 拡張計画

### 8.1 将来的な機能追加

- 追加ステージ
- 新キャラクター
- オンラインランキング
- 実績システム

### 8.2 プラットフォーム展開

- iOS版への移植
- Apple TV版への対応
- Steam配信検討

## 9. 開発リソース

### 9.1 開発環境

- **IDE**: Xcode 15+
- **言語**: Swift 5.9+
- **フレームワーク**: SwiftUI, SpriteKit
- **ツール**: Sketch/Figma（デザイン）、Logic Pro（音楽）

### 9.2 必要スキル

- Swift/SwiftUIプログラミング
- SpriteKitゲーム開発
- ピクセルアート作成
- サウンドエディティング基礎

### 9.3 開発期間

- **開発期間**: 4週間
- **ポリッシュ**: +2週間
- **リリース準備**: +1週間
- **合計**: 7週間

## 10. リスク管理

### 10.1 技術的リスク

- **SpriteKitの制限**: 代替手段の検討
- **パフォーマンス問題**: 最適化手法の研究
- **アセット品質**: 段階的な改善計画

### 10.2 スケジュールリスク

- **機能削減**: コア機能の優先実装
- **スコープ調整**: 必要に応じた機能延期
- **品質重視**: 完成度を優先した調整

この設計書に基づいて、段階的な実装を進めていきます。
